<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Break Atlas | Worldwide Breaking Spot & Jam Locator</title>

    <!-- External Resources -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">

    <!-- Our CSS -->
    <link rel="stylesheet" href="styles.css">

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
    <header>
        <button class="icon-btn" onclick="toggleNav()"><span class="material-icons-round">menu</span></button>
        <div class="logo">
            <span class="material-icons-round">public</span> Break Atlas
        </div>
        <div style="width: 40px;"></div>
    </header>

    <!-- NAVIGATION MENU -->
    <div class="nav-overlay" id="sideNav">
        <button class="icon-btn close-nav" onclick="toggleNav()"><span
                class="material-icons-round">close</span></button>
        <div style="margin-bottom: 30px; opacity: 0.5; font-size: 0.9rem; color: var(--text);">MENU</div>
        <div class="nav-item active" onclick="switchView('home')">Home</div>
        <div class="nav-item" onclick="switchView('profile')">My Profile</div>
        <div class="nav-item" onclick="switchView('crews')">My Crews</div>
        <div class="nav-item" onclick="switchView('favorites')">Favorites</div>
        <div class="nav-item" onclick="switchView('settings')">Settings</div>
        <div class="user-status" id="userStatus">Not logged in</div>
    </div>

    <!-- VIEW: HOME -->
    <div id="view-home" class="view-section active">
        <div class="search-container">
            <div class="search-wrapper">
                <input type="text" class="search-input" placeholder="Search city, jam, or crew..."
                    onkeyup="filterList(this.value)">
                <span class="material-icons-round search-icon-abs">search</span>
            </div>
        </div>

        <div class="filters">
            <div class="chip active" onclick="filterType('all', this)">All</div>
            <div class="chip" onclick="filterType('spot', this)">Training Spots</div>
            <div class="chip" onclick="filterType('jam', this)">Jams / Battles</div>
            <div class="chip" onclick="filterType('cypher', this)">Open Cyphers</div>
        </div>

        <div id="map"></div>

        <div class="listing-container">
            <div id="loader">Loading spots...</div>
            <div id="feed"></div>
        </div>

        <button class="fab" onclick="handleAddClick()">
            <span class="material-icons-round">add</span>
        </button>
    </div>

    <!-- VIEW: PROFILE -->
    <div id="view-profile" class="view-section">
        <div class="listing-container">
            <div id="profile-content">
                <!-- Injected by JS -->
            </div>
        </div>
    </div>

    <!-- VIEW: MY CREWS -->
    <div id="view-crews" class="view-section">
        <div class="listing-container">
            <div class="section-title"
                style="font-size:1.2rem; font-weight:700; margin-bottom:20px; color: var(--text);">
                My Crews
                <button onclick="alert('Create Crew feature coming soon!')"
                    style="background:none; border:none; color:var(--primary); font-weight:700; cursor:pointer; float:right;">+
                    Create</button>
            </div>
            <div id="crews-list">
                <!-- Mock Crews -->
                <div class="card" style="display:flex; align-items:center; padding:15px;">
                    <img src="https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=200"
                        style="width:50px; height:50px; border-radius:50%; margin-right:15px; object-fit:cover;">
                    <div style="flex:1;">
                        <div style="font-weight: 700; color: var(--text);">Paris City Breakers</div>
                        <div style="color: var(--text-sub); font-size: 0.85rem;">Paris, France â€¢ 12 Members</div>
                    </div>
                    <button class="btn-primary"
                        style="width:auto; padding:8px 15px; margin:0; font-size:0.8rem;">Member</button>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: FAVORITES -->
    <div id="view-favorites" class="view-section">
        <div class="listing-container">
            <div class="section-title"
                style="font-size:1.2rem; font-weight:700; margin-bottom:20px; color: var(--text);">Saved Spots & Jams
            </div>
            <div id="favorites-feed"></div>
        </div>
    </div>

    <!-- VIEW: SETTINGS -->
    <div id="view-settings" class="view-section">
        <div class="listing-container">
            <div class="section-title"
                style="font-size:1.2rem; font-weight:700; margin-bottom:20px; color: var(--text);">App Settings</div>

            <div class="form-group">
                <div class="form-label">Map Style</div>
                <button onclick="toggleMapStyle()" id="btn-map-style"
                    style="background:var(--bg); color:var(--text); border:1px solid rgba(128,128,128,0.3); padding:12px; border-radius:8px; cursor:pointer; width:100%;">Dark
                    Mode</button>
            </div>

            <div class="form-group">
                <div class="form-label">Accent Color</div>
                <div style="display:flex; gap:15px;">
                    <div class="color-dot"
                        style="width:30px; height:30px; border-radius:50%; background: #FF5722; cursor:pointer;"
                        onclick="setAccentColor('#FF5722')"></div>
                    <div class="color-dot"
                        style="width:30px; height:30px; border-radius:50%; background: #2196F3; cursor:pointer;"
                        onclick="setAccentColor('#2196F3')"></div>
                    <div class="color-dot"
                        style="width:30px; height:30px; border-radius:50%; background: #00E676; cursor:pointer;"
                        onclick="setAccentColor('#00E676')"></div>
                    <div class="color-dot"
                        style="width:30px; height:30px; border-radius:50%; background: #E91E63; cursor:pointer;"
                        onclick="setAccentColor('#E91E63')"></div>
                </div>
            </div>

            <div class="form-group" style="margin-top:40px;">
                <button onclick="clearData()"
                    style="background:none; border:1px solid #ff4444; color:#ff4444; padding:12px; border-radius:8px; cursor:pointer; width:100%;">Reset
                    App Data</button>
            </div>
        </div>
    </div>

    <!-- MODAL: SPOT DETAILS -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="close-modal" onclick="closeModal()">
                <span class="material-icons-round">close</span>
            </div>
            <img src="" id="modalImg" class="modal-header-img">
            <div class="modal-body">
                <div style="display:flex; justify-content:space-between; align-items:start;">
                    <span class="card-tag" id="modalType"></span>
                    <div id="modalFavBtn" class="material-icons-round"
                        style="font-size:2rem; color:#555; cursor:pointer;" onclick="toggleModalFavorite()">favorite
                    </div>
                </div>
                <h2 id="modalTitle" style="margin: 10px 0;"></h2>
                <p id="modalLoc" style="color: var(--primary); display:flex; align-items:center; gap:5px;">
                    <span class="material-icons-round" style="font-size:1rem">location_on</span> <span
                        id="modalCity"></span>
                </p>
                <hr style="border: 0; border-top: 1px solid rgba(128,128,128,0.2); margin: 20px 0;">
                <h3 style="font-size:1rem; margin-bottom:10px;">Schedule</h3>
                <p id="modalTime" style="color: var(--text-sub); margin-top: 5px;"></p>

                <div style="margin-top: 20px;">
                    <h3 style="font-size:1rem; margin-bottom:10px;">Description</h3>
                    <p id="modalDesc" style="color: var(--text-sub); line-height: 1.5; margin-top:5px;"></p>
                </div>
                <button class="btn-primary">Get Directions</button>
            </div>
        </div>
    </div>

    <!-- MODAL: ADD SPOT -->
    <div class="modal" id="addSpotModal">
        <div class="modal-content">
            <div class="close-modal" onclick="document.getElementById('addSpotModal').classList.remove('active')">
                <span class="material-icons-round">close</span>
            </div>
            <div class="modal-body">
                <h2>Add New Spot</h2>
                <p style="color:var(--text-sub); margin-bottom:20px;">Share a training spot, jam, or cypher with the
                    community.</p>

                <form id="addSpotForm" onsubmit="submitSpot(event)">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="addTitle" required
                            placeholder="e.g., Central Station Practice">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" id="addType">
                            <option value="spot">Training Spot</option>
                            <option value="jam">Jam / Battle</option>
                            <option value="cypher">Open Cypher</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <div class="location-picker-btn" id="locPickerBtn" onclick="startLocationPicker()">
                            <span class="material-icons-round">map</span>
                            <span id="locPickerText">Tap to pick on map</span>
                        </div>
                        <input type="hidden" id="addLat">
                        <input type="hidden" id="addLng">
                    </div>

                    <div class="form-group">
                        <div style="display:flex; gap:10px;">
                            <div style="flex:1;">
                                <label class="form-label">City</label>
                                <input type="text" class="form-input" id="addCity" required placeholder="Paris">
                            </div>
                            <div style="flex:1;">
                                <label class="form-label">Country</label>
                                <input type="text" class="form-input" id="addCountry" required placeholder="France">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Continent</label>
                        <select class="form-select" id="addContinent">
                            <option value="Europe">Europe</option>
                            <option value="Asia">Asia</option>
                            <option value="North America">North America</option>
                            <option value="South America">South America</option>
                            <option value="Africa">Africa</option>
                            <option value="Oceania">Oceania</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Schedule / Time</label>
                        <input type="text" class="form-input" id="addTime" placeholder="e.g., Weekdays 6PM - 9PM">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="addDesc"
                            placeholder="Floor type, vibe, entry fee..."></textarea>
                    </div>

                    <button type="submit" class="btn-primary">Create Spot</button>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL: AUTH -->
    <div class="modal" id="authModal">
        <div class="modal-content" style="height: auto; padding-bottom: 40px;">
            <div class="close-modal" onclick="toggleAuth()">
                <span class="material-icons-round">close</span>
            </div>
            <div class="modal-body" style="text-align: center;">
                <h2>Join the Cypher</h2>
                <p style="color: var(--text-sub); margin-bottom: 30px;">Connect with breakers, save spots, and register
                    for jams.</p>
                <button class="btn-primary btn-google" onclick="triggerGoogleLogin()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20">
                    Continue with Google
                </button>
                <p style="font-size: 0.8rem; margin-top: 15px; color: var(--text-sub);">By continuing, you agree to our
                    Terms.</p>
            </div>
        </div>
    </div>

    <!-- MODAL: EDIT PROFILE -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="close-modal" onclick="document.getElementById('editProfileModal').classList.remove('active')">
                <span class="material-icons-round">close</span>
            </div>
            <div class="modal-body">
                <h2>Edit Profile</h2>
                <p style="color:var(--text-sub); margin-bottom:20px;">Customize your breaker profile</p>

                <form id="editProfileForm" onsubmit="saveProfile(event)">
                    <div class="form-group">
                        <label class="form-label">Display Name</label>
                        <input type="text" class="form-input" id="editDisplayName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-textarea" id="editBio"
                            placeholder="Tell us about yourself, your crew, your style..." maxlength="300"></textarea>
                        <small style="color:var(--text-sub); font-size:0.75rem;">Max 300 characters</small>
                    </div>

                    <div class="form-group">
                        <div style="display:flex; gap:10px;">
                            <div style="flex:1;">
                                <label class="form-label">City</label>
                                <input type="text" class="form-input" id="editCity" placeholder="Paris">
                            </div>
                            <div style="flex:1;">
                                <label class="form-label">Country</label>
                                <input type="text" class="form-input" id="editCountry" placeholder="France">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Breaking Style</label>
                        <select class="form-select" id="editBreakingStyle">
                            <option value="">Select your primary style</option>
                            <option value="Power">Power Moves</option>
                            <option value="Footwork">Footwork</option>
                            <option value="Top Rock">Top Rock</option>
                            <option value="Freezes">Freezes</option>
                            <option value="All-around">All-around</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Years of Experience</label>
                        <input type="number" class="form-input" id="editExperience" min="0" max="50" placeholder="5">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Social Links (Optional)</label>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span style="color:var(--text-sub); width:30px;">IG</span>
                                <input type="text" class="form-input" id="editInstagram" placeholder="@username"
                                    style="flex:1;">
                            </div>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span style="color:var(--text-sub); width:30px;">YT</span>
                                <input type="text" class="form-input" id="editYoutube" placeholder="youtube.com/..."
                                    style="flex:1;">
                            </div>
                            <div style="display:flex; align-items:center; gap:8px;">
                                <span style="color:var(--text-sub); width:30px;">TT</span>
                                <input type="text" class="form-input" id="editTiktok" placeholder="@username"
                                    style="flex:1;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Profile Visibility</label>
                        <select class="form-select" id="editVisibility">
                            <option value="public">Public - Anyone can view</option>
                            <option value="private">Private - Only you can view</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">Save Profile</button>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>